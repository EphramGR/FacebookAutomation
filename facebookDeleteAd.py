# Generated by Selenium IDE
import pytest
import time
import json
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.common.action_chains import ActionChains
from selenium.webdriver.support import expected_conditions
from selenium.webdriver.support.wait import WebDriverWait
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.desired_capabilities import DesiredCapabilities

from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

from selenium.webdriver.firefox.options import Options

import time
import pyautogui

from selenium.webdriver.common.action_chains import ActionChains

import yaml, sys

import argparse
import os

parser = argparse.ArgumentParser(description='Deleting an ad off Facebook')
parser.add_argument('--addir',type=str, help='Diectory of the ad to delete, this is where the .yaml files are, and the photos you wanted to post. The geckoDriver and Mozzila package should be in there as well.')
args = parser.parse_args()

fileDir = args.addir

try:
  os.chdir(fileDir)
except:
  print("Invalid directory")

with open('marketplaceAd.yaml') as stream:
  adInfo = yaml.load(stream)

try:
  options = Options()
  options.binary_location = adInfo['firefox']
  driver = webdriver.Firefox(executable_path=adInfo['geckoDriver'], firefox_options=options)
except:
  print("Either the Firefox or GeckoDriver directory was invalid")

email = adInfo['loginEmail']
password = adInfo['loginPassword']

adRemove = "//div[@aria-label=\'" + str(adInfo['title']) + "\']"

def login():
  try:
    driver.get("https://www.facebook.com/")
    driver.set_window_size(1527, 869)
  except:
    print("Could not go to given website")

  try:
    driver.find_element(By.ID, "email").send_keys(email)
  except:
    print("Could not locate and/or send your given email to the email box")

  try:
    driver.find_element(By.ID, "pass").click()
    driver.find_element(By.ID, "pass").send_keys(password)
  except:
    print("Could not locate and/or send your given password to the password box")

  try:
    driver.find_element(By.NAME, "login").click()
  except:
    print("Could not locate and/or click the login box")


def gotoMarketplace():
  try:
    element = WebDriverWait(driver, 10).until(
        EC.presence_of_element_located((By.LINK_TEXT, "Marketplace"))
    )
    element.click()

    element = WebDriverWait(driver, 10).until(
        EC.presence_of_element_located((By.LINK_TEXT, "Your Account"))
    )
    element.click() 

  except:
    print("Could not navigate to marketplace and/or your account")

def removeAd():
  time.sleep(1)
  try:
    driver.find_element_by_xpath(adRemove).click()
  except:
    print("Could not find the ad that you want removed")

  try:
    element = WebDriverWait(driver, 10).until(
        EC.presence_of_element_located((By.CSS_SELECTOR, ".oqcyycmt:nth-child(2) > .oajrlxb2"))
    )
    element.click()

    element = WebDriverWait(driver, 10).until(
        EC.presence_of_element_located((By.CSS_SELECTOR, ".rq0escxv:nth-child(1) > .rq0escxv:nth-child(1) > .oajrlxb2 > .rq0escxv"))
    )
    element.click()

  except:
    print("Could not delete and confirm delete")


login()
gotoMarketplace()
removeAd()